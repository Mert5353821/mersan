import streamlit as st
import pandas as pd
from datetime import datetime

# 1. SAYFA AYARLARI VE TASARIM
st.set_page_config(page_title="Mersan GeliÅŸim AtÃ¶lyesi", page_icon="ğŸŒ¿")

st.markdown("""
    <style>
    .main { background-color: #f8f9fa; }
    .stButton>button { width: 100%; border-radius: 10px; background-color: #2e7d32; color: white; height: 3em; font-weight: bold; }
    .report-card { background: white; padding: 20px; border-radius: 15px; border-left: 5px solid #2e7d32; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .stTextInput>div>div>input { border-radius: 10px; }
    h1, h3 { color: #1e4620; text-align: center; }
    </style>
    """, unsafe_allow_html=True)

# 2. VERÄ° YÃ–NETÄ°MÄ° (Basitlik iÃ§in Session State kullanÄ±yoruz)
# Not: GerÃ§ek bir veritabanÄ± baÄŸlanana kadar veriler burada durur.
if 'veritabani' not in st.session_state:
    st.session_state.veritabani = pd.DataFrame(columns=["Veli Kodu", "Ã–ÄŸrenci AdÄ±", "Tarih", "Rapor Notu"])

# 3. YAN MENÃœ (NAVÄ°GASYON)
sayfa = st.sidebar.selectbox("Ä°ÅŸlem SeÃ§iniz", ["Veli GiriÅŸi", "YÃ¶netici Paneli (Mersan)"])

# --- YÃ–NETÄ°CÄ° PANELÄ° ---
if sayfa == "YÃ¶netici Paneli (Mersan)":
    st.header("ğŸ‘¨â€ğŸ« Rapor GiriÅŸ Paneli")
    admin_sifre = st.text_input("YÃ¶netici Åifresi:", type="password")
    
    if admin_sifre == "mersan2025": # Bu sizin giriÅŸ ÅŸifreniz
        st.success("GiriÅŸ YapÄ±ldÄ±")
        
        with st.form("rapor_formu", clear_on_submit=True):
            veli_kodu = st.text_input("Veliye Verilecek Ã–zel Kod (Ã–rn: ahmet01)")
            ogrenci_adi = st.text_input("Ã–ÄŸrenci AdÄ± SoyadÄ±")
            tarih = st.date_input("Ders Tarihi", datetime.now())
            rapor_notu = st.text_area("GeliÅŸim Notu / Ders Ã–zeti")
            
            submit = st.form_submit_button("Raporu Kaydet ve YayÄ±nla")
            
            if submit:
                yeni_rapor = pd.DataFrame([[veli_kodu, ogrenci_adi, tarih.strftime("%d.%m.%Y"), rapor_notu]], 
                                          columns=["Veli Kodu", "Ã–ÄŸrenci AdÄ±", "Tarih", "Rapor Notu"])
                st.session_state.veritabani = pd.concat([st.session_state.veritabani, yeni_rapor], ignore_index=True)
                st.balloons()
                st.success(f"{ogrenci_adi} iÃ§in rapor baÅŸarÄ±yla eklendi!")

# --- VELÄ° GÄ°RÄ°ÅÄ° ---
else:
    st.title("ğŸŒ¿ Mersan GeliÅŸim AtÃ¶lyesi")
    st.subheader("Veli Bilgilendirme Sistemi")
    
    veli_giris_kodu = st.text_input("Ã‡ocuÄŸunuza Ã¶zel kodu giriniz:", placeholder="Ã–rn: ahmet01", type="password")
    
    if veli_giris_kodu:
        df = st.session_state.veritabani
        sonuclar = df[df['Veli Kodu'] == veli_giris_kodu]
        
        if not sonuclar.empty:
            st.info(f"HoÅŸ geldiniz. **{sonuclar.iloc[0]['Ã–ÄŸrenci AdÄ±']}** iÃ§in kayÄ±tlÄ± raporlar aÅŸaÄŸÄ±dadÄ±r:")
            
            # RaporlarÄ± tersten listele (en yeni en Ã¼stte)
            for index, row in sonuclar[::-1].iterrows():
                st.markdown(f"""
                    <div class="report-card">
                        <span style="color: gray; font-size: 0.8em;">{row['Tarih']}</span>
                        <h4 style="margin-top: 5px;">GÃ¼nlÃ¼k GeliÅŸim Raporu</h4>
                        <p style="color: #333; line-height: 1.6;">{row['Rapor Notu']}</p>
                    </div>
                """, unsafe_allow_html=True)
        else:
            st.warning("Bu koda ait bir kayÄ±t bulunamadÄ±. LÃ¼tfen kodu kontrol edin.")

    st.markdown("---")
    st.caption("Â© 2025 Mersan GeliÅŸim AtÃ¶lyesi | Ä°letiÅŸim: [Telefon NumaranÄ±z]")
